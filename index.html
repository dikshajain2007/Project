<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CampusShare ‚Äì Donate & Exchange</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
    font-family:Segoe UI,Tahoma;
    background:linear-gradient(135deg,#667eea,#764ba2);
    min-height:100vh;
    padding:20px;
}
header{
    background:#fff;
    padding:20px;
    border-radius:15px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:20px;
}
h1{color:#4CAF50}

button{
    border:none;
    padding:10px 18px;
    border-radius:20px;
    cursor:pointer;
    font-weight:bold;
}
.btn-primary{background:#2196F3;color:#fff}
.btn-success{background:#4CAF50;color:#fff}
.hidden{display:none}

.container{display:none}
.container.active{display:block}

.stats{
    display:flex;
    justify-content:space-around;
    background:#fff;
    padding:20px;
    border-radius:15px;
    margin-bottom:20px;
}
.stat-number{font-size:2em;color:#4CAF50;font-weight:bold}

.search-section{
    background:#fff;
    padding:20px;
    border-radius:15px;
    margin-bottom:20px;
}
.search-box{display:flex;gap:10px}
.search-box input{
    flex:1;
    padding:12px;
    border-radius:20px;
    border:2px solid #ddd;
}

.listings{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
    gap:20px;
}
.item{
    background:#fff;
    padding:15px;
    border-radius:15px;
}
.item img{
    width:100%;
    height:180px;
    object-fit:cover;
    border-radius:10px;
}
.price{
    background:#e8f5e8;
    display:inline-block;
    padding:5px 12px;
    border-radius:15px;
    color:#4CAF50;
    font-weight:bold;
}

/* CHAT MODAL */
.modal{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.8);
}
.modal-content{
    background:#fff;
    width:90%;
    max-width:500px;
    padding:20px;
    border-radius:15px;
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
}

.chat-box{
    height:250px;
    overflow:auto;
    border:1px solid #ddd;
    padding:10px;
    margin-bottom:10px;
}
.chat-msg{
    margin-bottom:8px;
    padding:8px 12px;
    border-radius:10px;
}
.chat-user{
    background:#e8f5e8;
    text-align:right;
}
.chat-other{
    background:#f1f1f1;
}

/* GLOBAL CHAT BUTTON */
#globalChatBtn{
    position:fixed;
    bottom:20px;
    right:20px;
    background:#2196F3;
    color:white;
    width:60px;
    height:60px;
    border-radius:50%;
    font-size:26px;
}
</style>
</head>

<body>

<header>
<h1>üè´ CampusShare</h1>
<div>
<button id="loginBtn" onclick="showLogin()">Login</button>
<button id="logoutBtn" class="hidden" onclick="logout()">Logout</button>
</div>
</header>

<!-- LOGIN -->
<div id="login-container" class="container active">
    <div class="modal-content">
        <h2>Quick Login</h2>
        <input id="emailInput" placeholder="email@example.com" style="width:100%;padding:12px;margin:10px 0">
        <button class="btn-success" style="width:100%" onclick="login()">Login</button>
    </div>
</div>

<!-- MAIN -->
<div id="main-container" class="container">
    <div class="stats">
        <div><div class="stat-number">47</div>Items Shared</div>
        <div><div class="stat-number">2.3</div>Tons Saved</div>
        <div><div class="stat-number">128</div>Users</div>
    </div>

    <div class="search-section">
        <div class="search-box">
            <input id="searchInput" placeholder="Search items..." onkeyup="renderItems()">
            <button class="btn-primary" onclick="renderItems()">Search</button>
        </div>
    </div>

    <div class="listings" id="listings"></div>
</div>

<!-- ITEM CHAT -->
<div id="itemChatModal" class="modal">
    <div class="modal-content">
        <h3>Item Chat</h3>
        <div id="itemChatBox" class="chat-box"></div>
        <div style="display:flex;gap:8px">
            <input id="itemChatInput" style="flex:1;padding:10px" placeholder="Message...">
            <button class="btn-success" onclick="sendItemMessage()">Send</button>
        </div>
        <button class="btn-primary" style="margin-top:10px" onclick="closeItemChat()">Close</button>
    </div>
</div>

<!-- GLOBAL USER CHAT -->
<div id="globalChatModal" class="modal">
    <div class="modal-content">
        <h3>üë• Campus Chat</h3>
        <div id="globalChatBox" class="chat-box"></div>
        <div style="display:flex;gap:8px">
            <input id="globalChatInput" style="flex:1;padding:10px" placeholder="Message everyone...">
            <button class="btn-success" onclick="sendGlobalMessage()">Send</button>
        </div>
        <button class="btn-primary" style="margin-top:10px" onclick="closeGlobalChat()">Close</button>
    </div>
</div>

<button id="globalChatBtn" onclick="openGlobalChat()">üí¨</button>

<script>
let currentUser=null;
let activeItem=null;

const items=[
{id:1,title:"Calculus Book",desc:"Good condition",price:"Free",img:"https://images.unsplash.com/photo-1523050854058-8df90110c9f1",donor:"Rahul"},
{id:2,title:"Study Lamp",desc:"USB lamp",price:"‚Çπ100",img:"https://images.unsplash.com/photo-1554261922-2742a7ecdd28",donor:"Priya"},
{id:3,title:"Table Fan",desc:"Working",price:"‚Çπ300",img:"https://images.unsplash.com/photo-1600585154340-be6161a56a0c",donor:"Meera"}
];

let itemChats={};
let globalChat=[];

/* LOGIN */
function showLogin(){
    document.getElementById("login-container").classList.add("active");
    document.getElementById("main-container").classList.remove("active");
}
function login(){
    const email=document.getElementById("emailInput").value;
    if(!email.includes("@")) return alert("Invalid email");
    currentUser=email;
    document.getElementById("login-container").classList.remove("active");
    document.getElementById("main-container").classList.add("active");
    document.getElementById("loginBtn").classList.add("hidden");
    document.getElementById("logoutBtn").classList.remove("hidden");
    renderItems();
}
function logout(){location.reload()}

/* ITEMS */
function renderItems(){
    const q=document.getElementById("searchInput").value.toLowerCase();
    const box=document.getElementById("listings");
    box.innerHTML="";
    items.filter(i=>i.title.toLowerCase().includes(q))
    .forEach(i=>{
        box.innerHTML+=`
        <div class="item">
            <img src="${i.img}">
            <h3>${i.title}</h3>
            <p>${i.desc}</p>
            <div class="price">${i.price}</div>
            <p>By ${i.donor}</p>
            <button class="btn-primary" onclick="openItemChat(${i.id})">Chat</button>
        </div>`;
    });
}

/* ITEM CHAT */
function openItemChat(id){
    activeItem=id;
    if(!itemChats[id]) itemChats[id]=[];
    renderItemChat();
    document.getElementById("itemChatModal").style.display="block";
}
function closeItemChat(){
    document.getElementById("itemChatModal").style.display="none";
}
function sendItemMessage(){
    const msg=document.getElementById("itemChatInput").value;
    if(!msg) return;
    itemChats[activeItem].push({user:currentUser,text:msg});
    document.getElementById("itemChatInput").value="";
    renderItemChat();
}
function renderItemChat(){
    const box=document.getElementById("itemChatBox");
    box.innerHTML="";
    itemChats[activeItem].forEach(m=>{
        box.innerHTML+=`<div class="chat-msg ${m.user===currentUser?'chat-user':'chat-other'}">${m.user.split("@")[0]}: ${m.text}</div>`;
    });
    box.scrollTop=box.scrollHeight;
}

/* GLOBAL CHAT */
function openGlobalChat(){
    renderGlobalChat();
    document.getElementById("globalChatModal").style.display="block";
}
function closeGlobalChat(){
    document.getElementById("globalChatModal").style.display="none";
}
function sendGlobalMessage(){
    const msg=document.getElementById("globalChatInput").value;
    if(!msg) return;
    globalChat.push({user:currentUser,text:msg});
    document.getElementById("globalChatInput").value="";
    renderGlobalChat();
}
function renderGlobalChat(){
    const box=document.getElementById("globalChatBox");
    box.innerHTML="";
    globalChat.forEach(m=>{
        box.innerHTML+=`<div class="chat-msg ${m.user===currentUser?'chat-user':'chat-other'}">${m.user.split("@")[0]}: ${m.text}</div>`;
    });
    box.scrollTop=box.scrollHeight;
}
</script>

</body>
</html>
